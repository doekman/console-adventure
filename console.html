<!doctype HTML>
<html>
<title>console.log() adventure</title>
<script>
/**********************************************************************************************************************************************************
/*********   
/*********
/*********      A console.log() adventure game.
/*********
/*********
/*********      (c) Leon Bambrick 2014.
/*********      MIT License. (You are free to copy, extend, improve, sell.)
/*********
/*********
/*********      DO NOT READ THE SOURCE CODE UNTIL YOU'VE PLAYED THE GAME!!!!
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********      Just hit F12, to bring up the Console.
/*********
/*********
/*********
/*********
/*********      That's where the game is played.
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********      SERIOUSLY!!! Don't read the code, just play the game! F12 (Developer tools)... look at the console!
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********      SERIOUSLY!!! F12 (Dev tools), view "Console". Enter commands like 'n();' for north etc. 
/*********      It's not hard. You'll figure it out.
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/*********
/**********************************************************************************************************************************************************
*/
(function(exports) { /*** IIFE start **********************************************************************************************/
  'use strict';
    
  var styles = {
    big: "font-size:150%;color:red;font-weight:bold",
    mono: "font-family:Menlo,Consolas,monospace;color:slateblue"
  };
  
function start() {
 console.log("%c\
*********************************************\r\n\
*** Hi! Glad you made it down here.       ***\r\n\
*** Welcome to a console.log() adventure. ***\r\n\
*********************************************\r\n\
 ", styles.mono);
 console.error("Remember: View source is cheating (using reflection is OK, but it won't help you though).");
 console.info("Type [Help] for help at any time (commands are provided between [], so don't type the brackets).");
 init();
 c(say());

}

var movecount = 0, playerState;

function init() {
  movecount = 0;
  mapnum = 0; // we start on the first map.
  here = [9,5]; //x,y. Our starting position.
  playerInventory = { gold : 0, holding:null, food: 10}; //
  amulet = true; //this sits on the forest floor.
  gold = true; //inside the cave.
  playerState = { 'health' : 100, 'strength' : 100, 'wisdom' : 0, 'points': 0, 'hunger':0};
}

// Synonyms for our verbs...
function RegisterCommands(fnCommand, synonyms) {
  synonyms.split(',').forEach(function(cmd) {
    if (cmd in exports)
      console.error("%cCommand %s is already defined", styles.big, cmd, fnCommand);
    Object.defineProperty(exports, cmd, { get:function() { //HEY! No peaking!
      return fnCommand.apply(this, arguments);
    }});
  }); 
}

RegisterCommands(North,    'North,north,N,n');
RegisterCommands(South,    'South,south,S,s');
RegisterCommands(West,     'West,west,W,w');
RegisterCommands(East,     'East,east,E,e');
RegisterCommands(Enter,    'Enter,enter,En,en,Ent,ent');
RegisterCommands(Look,     'Look,look,L,l');
RegisterCommands(Take,     'Take,take,T,t');
RegisterCommands(Use,      'Use,use,U,u');
RegisterCommands(Speak,    'Speak,speak,Sp,sp,SP');
RegisterCommands(Inventory,'Inventory,inventory,Inv,inv,I,i');
RegisterCommands(Me,       'Me,me,M,m');
RegisterCommands(Fight,    'Fight,fight,F,f');
RegisterCommands(Up,       'Up,up');
RegisterCommands(Eat,      'Eat,eat,EAT');
RegisterCommands(Help,     'Help,help,HELP,H,h');
RegisterCommands(reset,    'Reset,reset,Restart,restart');

// VERBS!!!
function Help() {
  return "\
General commands are (without the []): [n], [s], [e], [w] for [North], [South], [East], [West].\r\n\
Also: [l] for [Look], [t] for [Take], [u] for [Use], [sp] for [Speak], [i] for [Inventory],\r\n\
[me] for player state, [f] for [fight], [r] for [Restart] and [h] for [Help].\r\n\
For *special* cheats, press Ctrl-F4/Cmd-W.";
}

function Eat() {
  if (playerState.hunger <= 0) {
    return "You are not hungry.";
  }
  if (playerInventory.food <= 0) {
    return "You have no food.";
  }
  
  playerInventory.food -= 1;
  playerState.hunger -= 1;  
  return "You eat a little food.";
}

function Look() {  
  c(say());
  var cell = maps[mapnum][here[1]][here[0]];
  //c(cell);
  switch(cell) {
    
	case "H" : return "The house is weathered, and appears abandoned. The front door is partially off its hinges. You could easily [Enter].";
	case "V" : return "Cool air blows from the cave. The entrance is large enough that you can [Enter]. You can move " + Possibilities();
	case "2" : return "There is a rope you can climb [Up]. It looks sturdy enough to hold your weight.";	
    case "k" : return "This kitchen contains one of those fancy Magic Amulet Receptacle Devices. You could try to [Use] it, I guess.";	
    case "r" : 
    {
        c("The room contains a bath, a sink, and a toilet that runs continuously.");
        c("There is a small window above the toilet. You step up onto the toilet seat,");
        c("to get a better view through the window. Yes, you can see the outside world,");
        c("and also... suddenly you fall through the window, landing on the ground outside.");
        c("You walk around the house until you find the front door.");
        here = [11,5];
        mapnum = 0;
        return say();	
    }
    default : return "You see nothing else.";
  }
  return "";
}
function Take(){
  var message = "There is nothing to take."
  var cell = maps[mapnum][here[1]][here[0]];
  //c(cell);
  switch(cell) {
    case "E" : {
       if (amulet == true) {
         message = "You pick up the amulet.";
         amulet = false;
         playerInventory.amulet = 1;
        }
    }
    case "3" : {
       if (gold == true) {
         message = "You take every last piece of gold.";
         gold = false;
         playerInventory.gold = 100;
       }
    }
  }
  
  return message;
}
function Use(x) {
  var message = "You can't use that here.";
  var cell = maps[mapnum][here[1]][here[0]];
  //c(cell);
  switch(cell) {
    case "k" : {
        if (playerInventory.amulet == 1) {
          win(0);
          //init();
          return "click.";
        } else {
          message = "It's not clear how to use this Magic Amulet Receptacle Device. Perhaps it requires a magic amulet. But where would we get one of those?";
        }
    }
  }  
  return message;
}
function reset() {
  location.reload(); //console acts weird on reset (Safari), and this works...
 console.clear();
 document.body.style.background = "#FFF";
 document.body.innerHTML ="";
 init();
 
 return say();
}
function win(n) {
  switch(n) {
    case 0 : c("You take out the amulet and place it in the Magic Amulet Receptacle Device."); break;
    case 1 : c("It begins to hum."); break;
    case 2 : c("Sparks!"); break;
    case 3 : c("A bolt of lightning!"); break;
    case 4 : c("Magic energy lifts you from the floor..."); break;
    case 5 : c("Suddenly, everything goes dark."); break;
    case 6 : console.log('%c Oh my heavens! You look up and see a new world.', 'background: #222; color: #bada55'); break;
    case 7 : console.log('%c You realize at once that everything you have experienced is a mere shadow of the true world.', 'background: #222; color: #bada55'); break;
    case 8 : console.log('%c You\'ve labored in a phantom world, fleeting and unreal, while the real world of ideas, far more powerful and permanent than your own, was right there all along, hovering above you.', 'background: #222; color: #bada55'); break;
    case 9 : console.log('%c You turn to the world above you, and contemplate it\'s majesty.', 'background: #222; color: #bada55'); break;
    case 10 : break; //pause for a beat.
    case 11 : {document.body.style.background = "#FF00FF";
              var message = "";
              if (movecount < 20) {
                message = " (with only a little bit of cheating)";
              }
              document.body.innerHTML = '<div class="win">You won in ' + movecount + ' moves.' + message + '</div><p><code>[reset]</code> to play again.</p>';
            init();} break;
  }
  if (n < 11) {
    setTimeout(function(){ win(n+1); }, 2000);        
  }
  if (n==0) {
    return "You stand back";
  }
}
function Fight(){
 return "You punch wildly at the air. Exhausted, you sit down.";
}
function Speak(){
 return "You talk. Nobody listens.";
}
function Inventory() {
 cj(playerInventory);
}
function Me() {
 cj(playerState);
}
var playerInventory = {};
//Note, ensure each map has a border of dots (this makes game logic simpler)
var maps = [[   
"...................", //0 (Starting map!)
".....ffffffff..f...", //1
"...ffffffffffffff..", //2
"...f.ffffFffffEf...", //3
"...W.....P..fffff..", //4
".......CPTPH.......", //5
".........P.........", //6
".........V.........", //7
"...................", //8
"...................", //9
"..................."], //10
[
".......", //0 (House map!)
"..k.r..", //1
".bhhhy.", //2
"..a....", //3
"......."], //4
[
".......", //0 (Cave!)
"..3.2..", //1
".4100..", //2
"......."]] //3

var here = [9,5]; //x,y
var mapnum = 0;

function move(x,y) {
 if ((here[0] + x < 0)||(here[0] + x > maps[mapnum][0].length)) return "the edge of the world has been reached.";
 if ((here[1] + y < 0)||(here[1] + y > maps[mapnum].length)) return "the edge of the world has been reached.";
 if (maps[mapnum][here[1]+y][here[0]+x] == ".") return "the way is blocked";
 movecount++;
 here[0]+=x;
 here[1]+=y;
 return say(); 
}
var amulet=true;
var gold=true;
function elfhut() {
  var message = "A clearing in the forest, with an abandoned elf hut.";
  if (amulet == true) {
    message += "\r\nAn amulet lies on the floor.";
  }
  return message;
}
function horde() {
  var message = "An empty cavern.";
  if (gold == true) {
    message = "There is a horde of treasure. Gold coins, goblets, trinkets.";
  }
  return message;
}
function say() {
  var cell = maps[mapnum][here[1]][here[0]];
  switch(cell) {
    case "T" : return "You are in a town square. Paths lead to the " + Possibilities() + ".";
	case "P" : return "You walk carefully along the path. You can move " + Possibilities() + ".";
	case "H" : return "There is a house.";
	case "F" : return "A spooky forest. You can proceed " + Possibilities() + ".";
  	case "f" : return "The forest is so thick, you don't know what directions are possible.";
    case "E" : return elfhut();
    case "W" : return "A stream with a waterfall blocks your way. It is teeming with fish.";
	case "C" : return "You are standing on a cliff by the sea. Seagulls are squawking.";
	case "V" : return "The entrance to a cave. Chills run up and down your spine.";
	case "k" : return "You are in a kitchen. You can move " + Possibilities() + ".";
	case "h" : return "You are in a hallway. You can move " + Possibilities() + ".";
	case "r" : return "You are in a bedroom. You can move " + Possibilities() + ".";
	case "b" : return "You are in a bathroom. You can move " + Possibilities() + ".";
	case "y" : return "You are in a foyer. You can move " + Possibilities() + ".";
	case "a" : return "Stairs lead up to an attic. You can move [Up], " + Possibilities() + ".";
	case "0" : return "You are in a deep dark tunnel. Feeling with your fingers you find you can move " + Possibilities() + ".";
	case "1" : return "Somehow it is even darker here. You feel yourself going cray cray. The one thing you still have is your sense of direction. You can move " + Possibilities() + ".";
	case "2" : return "You are in a wide open cavern. Bones litter the floor. You can move " + Possibilities() + ".";
	case "3" : return horde();
	case "4" :  { c("A bottomless pit. You fall forever.");console.error("\r\n G A M E  O V E R");init(); c(say()); return "";}
    default : return "You are in a place i do not recognize.";
  }
  return "";
}

function Up() { 
 var cell = maps[mapnum][here[1]][here[0]];
 if (cell == 'a') {
    c("You begin to climb the stairs. There is a creaking noise. The stairs collapse. The entire house falls on top of you.");console.error("\r\n G A M E  O V E R");init(); c(say()); return "";
 } else  if (mapnum ==2 && cell == '2') {
	mapnum = 0;
	here = [9,7];
    c("Slowly you climb the rope. It creaks and threatens to snap. Eventually you've hauled yourself to the surface.");
	c("Stepping around a large boulder you find...");
	return say();
 } else return "You cannot do that here.";
 
}

function Enter() {
 var cell = maps[mapnum][here[1]][here[0]];
 
  switch(cell) {
    case "H" : {
			mapnum = 1;
			c("You push the door open and step inside.");
			here = [5,2];
			return say();
		}
    case "V" : {
			mapnum = 2;
			c("You walk slowly inside... you fall a short distance, it is too far to climb back up. It is pitch black. You are likely to be eaten by a grue.");
			here = [4,2];
			return say();
		}
    default : return "That is not possible here.";
  }
  return "";
}

function Possibilities() {
  var poss = [];
  if (maps[mapnum][here[1]-1][here[0]] != ".") poss[poss.length] = "[North]";
  if (maps[mapnum][here[1]+1][here[0]] != ".") poss[poss.length] = "[South]";
  if (maps[mapnum][here[1]][here[0]+1] != ".") poss[poss.length] = "[East]";
  if (maps[mapnum][here[1]][here[0]-1] != ".") poss[poss.length] = "[West]";
  return replaceLast(poss.join(", "), ", ", " and "); //sometimes ' or ' would be better... ah well.
}
function North() {
  return move(0, -1);
}

function South() {
 return move(0, 1);
}

function West() {
  return move(-1, 0);
}

function East() {
  return move(1, 0);
}

function c(s) {
 console.log(s);
}
function cls() {
 console.clear();
}

function cj(o) {
c(JSON.stringify(o, null, "\t"));
return "";
}

function replaceLast(x, what, replacement) {
    return x.split("").reverse().join("").replace(new RegExp(what.split("").reverse().join("")), replacement.split("").reverse().join("")).split("").reverse().join("");
};
start();

/***/ })(window); /** IIFE end*****************************************************************************************************/

</script>
<style>
.hidden { color:white}
.hidden:hover {
color:black;
}
.win {
 font-size:72px;
 -webkit-animation: color_change 2s infinite alternate;
 -moz-animation: color_change 2s infinite alternate;
 -ms-animation: color_change 2s infinite alternate;
 -o-animation: color_change 2s infinite alternate;
 animation: color_change 2s infinite alternate;
}

@-webkit-keyframes color_change {
 from { color: blue; text-shadow:0 0 10px #FF0;}
 to { color: #FF00FF; }
}
@-moz-keyframes color_change {
 from { color: blue; text-shadow:0 0 10px #FF0; }
 to { color: #FF00FF; }
}
@-ms-keyframes color_change {
 from { color: blue; text-shadow:0 0 10px #FF0; }
 to { color: #FF00FF; }
}
@-o-keyframes color_change {
 from { color: blue; text-shadow:0 0 10px #FF0; }
 to { color: #FF00FF; }
}
@keyframes color_change {
 from { color: blue; text-shadow:0 0 10px #FF0; }
 to { color: #FF00FF; }
}
</style>
<body>
<a href="https://github.com/secretGeek/console-adventure"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>
<p>This website best viewed with F12 | Console.</p>
<p class='hidden'>Seriously, press F12 to bring up the developer tools. And then go to the <code>Console.</code> A message awaits.</p>
</body>
</html>
